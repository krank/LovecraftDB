{"version":3,"sources":["bundle.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","__esModule","Interfaces","dataBlobs","name","type","BlobType","generalMetaData","documentElementType","DocumentNodeType","input","documentElementClass","xmlElementName","list","textarea","xmlElementChildrenName","containsNames","attributePairs","text","xml","attribute","value","fulltext","summary","./modules/interfaces","2","FormHandling","setupDialog","title","useSearchForm","submitButtons","dialog","submitButtonTemplate","submitButtonContainer","dialogTemplate","document","querySelector","importNode","content","appendChild","innerHTML","classList","toggle","querySelectorAll","forEach","button","disabled","buttonInfo","submitButtonFragment","submitButtonElement","textContent","addValidation","./forms","3","DecisionDialog","SetTextBody","replace","force","textBodyElement","displayDialog","dispatchEvent","Event","bubbles","click","GetTextBody","./decisiondialog","4","description","dataString","callback","dialogTitle","dialogDescription","closeListener","event","preventDefault","this","removeEventListener","returnValue","addEventListener","showModal","5","getHtmlElementOf","dataBlob","getWarning","elementSelector","warningSelector","element","warningElement","unwrapElement","parent","parentNode","firstChild","insertBefore","removeChild","./interfaces","6","saveFile","mime","data","navigator","msSaveBlob","Blob","linkElement","createElement","setAttribute","url","window","URL","createObjectURL","revokeObjectURL","remove","loadFile","config","inputElement","file","target","files","fileReader","FileReader","readAsText","result","console","log","7","SetSubmitButtonEnabled","form","state","checkValidity","8","localConfig","NameSearch","MetaData","Xml","Dom","CodeView","mouseDown","richTextSelectionHandler","htmlTextElement","displayRichTextSelectionToolbar","selection","getSelection","rangeCount","getRangeAt","collapsed","removeRichTextSelectionToolbar","range","contains","startContainer","endContainer","selectionToolbar","getSelectionToolbar","rangeBound","getBoundingClientRect","xPosition","x","yPosition","y","height","style","left","top","createIfNull","template","clone","category","filter","addToListelement","toString","trim","addSelectionToList","gender","startElement","tagName","mark","intersectsNode","genderMark","className","surroundContents","_a","genderSelection","setup","item","id","domParser","DOMParser","codeElement","richTextElement","originalContentString","originalContentDom","parseFromString","newDom","transformXml","xslCodeToHTML","textWithMarkedNames","nameRegex","xslHTMLToCode","xslPrettyXML","resultString","unwrapXml","./codeview","./dom","./metadata","./namesearch","./xml","9","10","BigDialog","getMediaWikiText","article","wikiUrl","resultHandler","fetch","then","response","json","convertedText","pages","query","page","Object","keys","revisions","slots","main","fieldName","regex","field","exec","setMetadataField","regexp","replacement","exhaust","search","defaultSearch","searchForm","wikiDialog","resultRowTemplate","endpoint","titles","container","resultsForm","searchResults","push","row","cloneNode","selectedItem","wikiUrl_1","alert","./bigdialog","11","cleanList","originalContent","split","line","parts","metaData","resultList","index","self","map","innerItem","indexOf","sort","b","join","newContent","originalText","originalContentArray","newContentArray","concat","newText","fieldElement","setupLists","btn","sectionParent","parentElement","matches","textAreaElement","cursorStart","lineStart","lineEnd","currentTarget","selectionStart","Math","max","substr","lastIndexOf","substring","12","itemOptions","resultsContainer","template_1","optionTemplate_1","match","matchGroup","abstractStart","abstractMain","abstractEnd","optionTemplate","optionsContainer","rowElement","textElement","detailsElement","innerText","matchText","indexStart","indexEnd","itemOption","optionElement","spanElement","checked","displayMatches","regExp","groups","foundNames","lastIndex","findUniqueMatches","pair","charAt","toUpperCase","slice","categorized_1","categoryName","13","xmlDocument","documentElement","originalDocument","xslStylesheet","xsltProcessor","XSLTProcessor","importStylesheet","transformToDocument","domElements","xmlString","testDom","makeXML","implementation","createDocument","xmlRoot","xmlElement","xmlChildElement_1","attributes_1","toLowerCase","attributePair","XMLSerializer","serializeToString","loadXml","xmlText","xmlChildElements","textElements_1","childElement","attributePreamble","getAttribute","xmlDocument_1","replaceChild","clear","decision","14","FileManagement","HtmlView","MediaWikiSearch","Config","filename","./DataBlobConfig","./modules/codeview","./modules/filemanagement","./modules/htmlview","./modules/mediawikisearch","./modules/metadata","./modules/namesearch","./modules/xml"],"mappings":"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","file":"bundle.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\r\nexports.__esModule = true;\r\nvar Interfaces = require(\"./modules/interfaces\");\r\nexports.dataBlobs = [\r\n    {\r\n        name: \"Title\",\r\n        type: Interfaces.BlobType.generalMetaData,\r\n        documentElementType: Interfaces.DocumentNodeType.input,\r\n        documentElementClass: \"title\",\r\n        xmlElementName: \"title\"\r\n    },\r\n    {\r\n        name: \"Author\",\r\n        type: Interfaces.BlobType.generalMetaData,\r\n        documentElementType: Interfaces.DocumentNodeType.input,\r\n        documentElementClass: \"author\",\r\n        xmlElementName: \"author\"\r\n    },\r\n    {\r\n        name: \"Written\",\r\n        type: Interfaces.BlobType.generalMetaData,\r\n        documentElementType: Interfaces.DocumentNodeType.input,\r\n        documentElementClass: \"written\",\r\n        xmlElementName: \"written\"\r\n    },\r\n    {\r\n        name: \"Published\",\r\n        type: Interfaces.BlobType.generalMetaData,\r\n        documentElementType: Interfaces.DocumentNodeType.input,\r\n        documentElementClass: \"published\",\r\n        xmlElementName: \"published\"\r\n    },\r\n    {\r\n        name: \"Tags\",\r\n        type: Interfaces.BlobType.list,\r\n        documentElementType: Interfaces.DocumentNodeType.textarea,\r\n        documentElementClass: \"tags\",\r\n        xmlElementName: \"tags\",\r\n        xmlElementChildrenName: \"tag\"\r\n    },\r\n    {\r\n        name: \"Characters\",\r\n        type: Interfaces.BlobType.list,\r\n        containsNames: true,\r\n        documentElementType: Interfaces.DocumentNodeType.textarea,\r\n        documentElementClass: \"characters\",\r\n        xmlElementName: \"characters\",\r\n        xmlElementChildrenName: \"character\",\r\n        attributePairs: [\r\n            {\r\n                text: \"m\",\r\n                xml: {\r\n                    attribute: \"gender\",\r\n                    value: \"male\"\r\n                }\r\n            },\r\n            {\r\n                text: \"f\",\r\n                xml: {\r\n                    attribute: \"gender\",\r\n                    value: \"female\"\r\n                }\r\n            },\r\n            {\r\n                text: \"o\",\r\n                xml: {\r\n                    attribute: \"gender\",\r\n                    value: \"other\"\r\n                }\r\n            },\r\n            {\r\n                text: \"u\",\r\n                xml: {\r\n                    attribute: \"gender\",\r\n                    value: \"unknown\"\r\n                }\r\n            },\r\n            {\r\n                text: \"0\",\r\n                xml: {\r\n                    attribute: \"type\",\r\n                    value: \"narrator\"\r\n                }\r\n            },\r\n            {\r\n                text: \"1\",\r\n                xml: {\r\n                    attribute: \"type\",\r\n                    value: \"main\"\r\n                }\r\n            },\r\n            {\r\n                text: \"2\",\r\n                xml: {\r\n                    attribute: \"type\",\r\n                    value: \"interacted\"\r\n                }\r\n            },\r\n            {\r\n                text: \"3\",\r\n                xml: {\r\n                    attribute: \"type\",\r\n                    value: \"mentioned\"\r\n                }\r\n            }\r\n        ]\r\n    },\r\n    {\r\n        name: \"Mythos entities\",\r\n        type: Interfaces.BlobType.list,\r\n        containsNames: true,\r\n        documentElementType: Interfaces.DocumentNodeType.textarea,\r\n        documentElementClass: \"entities\",\r\n        xmlElementName: \"entities\",\r\n        xmlElementChildrenName: \"entity\"\r\n    },\r\n    {\r\n        name: \"Books\",\r\n        type: Interfaces.BlobType.list,\r\n        containsNames: true,\r\n        documentElementType: Interfaces.DocumentNodeType.textarea,\r\n        documentElementClass: \"books\",\r\n        xmlElementName: \"books\",\r\n        xmlElementChildrenName: \"book\"\r\n    },\r\n    {\r\n        name: \"Locations\",\r\n        type: Interfaces.BlobType.list,\r\n        containsNames: true,\r\n        documentElementType: Interfaces.DocumentNodeType.textarea,\r\n        documentElementClass: \"locations\",\r\n        xmlElementName: \"locations\",\r\n        xmlElementChildrenName: \"location\"\r\n    },\r\n    {\r\n        name: \"Phobias\",\r\n        type: Interfaces.BlobType.list,\r\n        documentElementType: Interfaces.DocumentNodeType.textarea,\r\n        documentElementClass: \"phobias\",\r\n        xmlElementName: \"phobias\",\r\n        xmlElementChildrenName: \"phobia\"\r\n    },\r\n    {\r\n        name: \"Notes\",\r\n        type: Interfaces.BlobType.list,\r\n        documentElementType: Interfaces.DocumentNodeType.textarea,\r\n        documentElementClass: \"notes\",\r\n        xmlElementName: \"notes\",\r\n        xmlElementChildrenName: \"note\"\r\n    },\r\n    {\r\n        name: \"Related reading\",\r\n        type: Interfaces.BlobType.list,\r\n        documentElementType: Interfaces.DocumentNodeType.textarea,\r\n        documentElementClass: \"related\",\r\n        xmlElementName: \"related\",\r\n        xmlElementChildrenName: \"item\"\r\n    },\r\n    {\r\n        name: \"Full text\",\r\n        type: Interfaces.BlobType.fulltext,\r\n        documentElementType: Interfaces.DocumentNodeType.textarea,\r\n        documentElementClass: \"fulltext\",\r\n        xmlElementName: \"body\"\r\n    },\r\n    {\r\n        name: \"Summary\",\r\n        type: Interfaces.BlobType.summary,\r\n        documentElementType: Interfaces.DocumentNodeType.textarea,\r\n        documentElementClass: \"summary\",\r\n        xmlElementName: \"summary\"\r\n    }\r\n];\r\n\n},{\"./modules/interfaces\":9}],2:[function(require,module,exports){\n\"use strict\";\r\nexports.__esModule = true;\r\nvar FormHandling = require(\"./forms\");\r\nfunction setupDialog(title, useSearchForm, submitButtons) {\r\n    var dialogTemplate = document.querySelector(\".big.dialog\");\r\n    var dialogFragment = document.importNode(dialogTemplate, true).content;\r\n    var dialog = dialogFragment.querySelector(\"dialog\");\r\n    document.querySelector(\"body\").appendChild(dialog);\r\n    dialog.querySelector(\"header h2\").innerHTML = title;\r\n    dialog.querySelector(\"form.search-box\").classList.toggle(\"hidden\", !useSearchForm);\r\n    dialog.querySelector(\"input.query\").value = \"\";\r\n    dialog.querySelector(\"section.results ul\").innerHTML = \"\";\r\n    dialog.querySelector(\"section.buttons\").innerHTML = \"\";\r\n    dialog.querySelectorAll(\"section.buttons button\").forEach(function (button) {\r\n        button.disabled = true;\r\n    });\r\n    setupSubmitButtons(dialog, submitButtons);\r\n    FormHandling.addValidation(dialog.querySelector(\"form.search-box\"));\r\n    FormHandling.addValidation(dialog.querySelector(\"form.search-results\"));\r\n    return dialog;\r\n}\r\nexports.setupDialog = setupDialog;\r\nfunction setupSubmitButtons(dialog, submitButtons) {\r\n    var submitButtonTemplate = dialog.querySelector(\"template.submit-button\");\r\n    var submitButtonContainer = dialog.querySelector(\".buttons\");\r\n    submitButtons.forEach(function (buttonInfo) {\r\n        var submitButtonFragment = document.importNode(submitButtonTemplate.content, true);\r\n        var submitButtonElement = submitButtonFragment.querySelector(\"button\");\r\n        submitButtonElement.value = buttonInfo.value;\r\n        submitButtonElement.title = buttonInfo.title;\r\n        submitButtonElement.textContent = buttonInfo.text;\r\n        submitButtonElement.disabled = true;\r\n        submitButtonContainer.appendChild(submitButtonFragment);\r\n    });\r\n}\r\n\n},{\"./forms\":7}],3:[function(require,module,exports){\n\"use strict\";\r\nexports.__esModule = true;\r\nvar DecisionDialog = require(\"./decisiondialog\");\r\nfunction SetTextBody(text, replace, force) {\r\n    if (replace === void 0) { replace = true; }\r\n    if (force === void 0) { force = false; }\r\n    var textBodyElement = document.querySelector(\"main textarea.textcode\");\r\n    var extraLinefeedRegexp = /\\>\\n\\<(?!\\/)/g;\r\n    text = text.replace(extraLinefeedRegexp, \">\\n\\n<\");\r\n    if (replace) {\r\n        if (textBodyElement.value.length != 0 && !force) {\r\n            DecisionDialog.displayDialog(\"Replace\", \"Are you sure? This will mean losing the current text body.\", text, function (text) {\r\n                textBodyElement.value = text;\r\n            });\r\n        }\r\n        else {\r\n            textBodyElement.value = text;\r\n        }\r\n    }\r\n    else {\r\n        textBodyElement.value += \"\\n\\n\" + text;\r\n    }\r\n    textBodyElement.dispatchEvent(new Event(\"input\", { bubbles: true }));\r\n    ResetTabs();\r\n}\r\nexports.SetTextBody = SetTextBody;\r\nfunction GetTextBody() {\r\n    var textBodyElement = document.querySelector(\"main textarea.textcode\");\r\n    return textBodyElement.value;\r\n}\r\nexports.GetTextBody = GetTextBody;\r\nfunction ResetTabs() {\r\n    var codeTabElement = document.querySelector(\"input#code\");\r\n    codeTabElement.click();\r\n}\r\n\n},{\"./decisiondialog\":4}],4:[function(require,module,exports){\n\"use strict\";\r\nexports.__esModule = true;\r\nfunction displayDialog(title, description, dataString, callback) {\r\n    var dialog = document.querySelector(\"dialog.decision\");\r\n    var dialogTitle = dialog.querySelector(\"h2\");\r\n    var dialogDescription = dialog.querySelector(\"p\");\r\n    dialog.dataString = dataString;\r\n    dialogTitle.textContent = title;\r\n    dialogDescription.textContent = description;\r\n    dialog.closeListener = function (event) {\r\n        event.preventDefault();\r\n        var dialog = this;\r\n        dialog.removeEventListener(\"close\", dialog.closeListener);\r\n        if (this.returnValue == \"yes\") {\r\n            callback(dialog.dataString);\r\n        }\r\n    };\r\n    dialog.addEventListener(\"close\", dialog.closeListener);\r\n    dialog.showModal();\r\n}\r\nexports.displayDialog = displayDialog;\r\n\n},{}],5:[function(require,module,exports){\n\"use strict\";\r\nexports.__esModule = true;\r\nvar Interfaces = require(\"./interfaces\");\r\nfunction getHtmlElementOf(dataBlob, getWarning) {\r\n    var elementSelector = \"\";\r\n    var warningSelector = \"\";\r\n    switch (dataBlob.type) {\r\n        case Interfaces.BlobType.generalMetaData: {\r\n            elementSelector = \".metadata label.\" + dataBlob.documentElementClass + \" input\";\r\n            warningSelector = \".metadata label.\" + dataBlob.documentElementClass + \" span\";\r\n            break;\r\n        }\r\n        case Interfaces.BlobType.list: {\r\n            elementSelector = \".metadata section.\" + dataBlob.documentElementClass + \" textarea\";\r\n            warningSelector = \".metadata section.\" + dataBlob.documentElementClass + \" h2\";\r\n            break;\r\n        }\r\n        case Interfaces.BlobType.fulltext:\r\n        case Interfaces.BlobType.summary: {\r\n            elementSelector = \"main section.\" + dataBlob.documentElementClass + \" textarea\";\r\n            warningSelector = \"main section.\" + dataBlob.documentElementClass + \" h2\";\r\n            break;\r\n        }\r\n    }\r\n    return {\r\n        element: document.querySelector(elementSelector),\r\n        warningElement: getWarning ? document.querySelector(warningSelector) : null\r\n    };\r\n}\r\nexports.getHtmlElementOf = getHtmlElementOf;\r\nfunction unwrapElement(element) {\r\n    var parent = element.parentNode;\r\n    while (element.firstChild) {\r\n        parent.insertBefore(element.firstChild, element);\r\n    }\r\n    parent.removeChild(element);\r\n}\r\nexports.unwrapElement = unwrapElement;\r\n\n},{\"./interfaces\":9}],6:[function(require,module,exports){\n\"use strict\";\r\nexports.__esModule = true;\r\nfunction saveFile(name, mime, data) {\r\n    if (data != null && navigator.msSaveBlob)\r\n        return navigator.msSaveBlob(new Blob([data], { type: mime }), name);\r\n    var linkElement = document.createElement(\"a\");\r\n    linkElement.setAttribute(\"style\", \"display:none\");\r\n    var url = window.URL.createObjectURL(new Blob([data], { type: mime }));\r\n    linkElement.setAttribute(\"href\", url);\r\n    linkElement.setAttribute(\"download\", name);\r\n    linkElement.click();\r\n    window.URL.revokeObjectURL(url);\r\n    linkElement.remove();\r\n}\r\nexports.saveFile = saveFile;\r\nfunction loadFile(callback, config) {\r\n    var inputElement = document.createElement(\"input\");\r\n    inputElement.type = \"file\";\r\n    inputElement.addEventListener(\"change\", function (event) {\r\n        var eventTarget = event.target;\r\n        var file = eventTarget.files[0];\r\n        var fileReader = new FileReader();\r\n        fileReader.readAsText(file, \"utf-8\");\r\n        fileReader.addEventListener(\"load\", function (event) {\r\n            var fileReader = event.target;\r\n            if (fileReader.result.length == 0) {\r\n                console.log(\"Uh-oh, spaghetti-o's! That file seems empty, just like my soul.\");\r\n            }\r\n            callback(fileReader.result, config);\r\n        });\r\n    });\r\n    inputElement.click();\r\n}\r\nexports.loadFile = loadFile;\r\n\n},{}],7:[function(require,module,exports){\n\"use strict\";\r\nexports.__esModule = true;\r\nfunction addValidation(form) {\r\n    form.addEventListener(\"input\", function () {\r\n        var form = this;\r\n        SetSubmitButtonEnabled(form, form.checkValidity());\r\n    });\r\n}\r\nexports.addValidation = addValidation;\r\nfunction SetSubmitButtonEnabled(form, state) {\r\n    form.querySelectorAll(\"button[type=submit]\").forEach(function (button) {\r\n        button.disabled = !state;\r\n    });\r\n}\r\nexports.SetSubmitButtonEnabled = SetSubmitButtonEnabled;\r\n\n},{}],8:[function(require,module,exports){\n\"use strict\";\r\nexports.__esModule = true;\r\nvar NameSearch = require(\"./namesearch\");\r\nvar MetaData = require(\"./metadata\");\r\nvar Xml = require(\"./xml\");\r\nvar Dom = require(\"./dom\");\r\nvar CodeView = require(\"./codeview\");\r\nvar mouseDown = false;\r\nvar localConfig;\r\nfunction setup(config) {\r\n    localConfig = config;\r\n    document.querySelectorAll(\"input#html, input#code\").forEach(function (item) {\r\n        item.addEventListener(\"change\", function (event) {\r\n            var id = event.target.id;\r\n            var domParser = new DOMParser();\r\n            var codeElement = document.querySelector(\"textarea.textcode\");\r\n            var richTextElement = document.querySelector(\"div.htmltext\");\r\n            if (id == \"html\") {\r\n                var originalContentString = \"<body>\" + codeElement.value + \"</body>\";\r\n                var originalContentDom = domParser.parseFromString(originalContentString, \"text/xml\");\r\n                var newDom = Xml.transformXml(originalContentDom, Xml.xslCodeToHTML);\r\n                var textWithMarkedNames = markNames(newDom.querySelector(\"div.body\").innerHTML);\r\n                richTextElement.innerHTML = textWithMarkedNames;\r\n            }\r\n            else if (id == \"code\") {\r\n                var originalContentString = \"<work>\" + richTextElement.innerHTML + \"</work>\";\r\n                var originalContentDom = domParser.parseFromString(originalContentString, \"text/xml\");\r\n                var newDom = Xml.transformXml(originalContentDom, Xml.xslHTMLToCode);\r\n                newDom = Xml.transformXml(newDom, Xml.xslPrettyXML);\r\n                var resultString = Xml.unwrapXml(newDom);\r\n                CodeView.SetTextBody(resultString, true, true);\r\n            }\r\n        });\r\n    });\r\n    document.addEventListener(\"mousedown\", function () {\r\n        mouseDown = true;\r\n    });\r\n    document.addEventListener(\"mouseup\", function () {\r\n        mouseDown = false;\r\n    });\r\n    document.addEventListener(\"selectionchange\", richTextSelectionHandler);\r\n}\r\nexports.setup = setup;\r\nfunction markNames(originalText) {\r\n    var resultString = originalText.replace(NameSearch.nameRegex, ' <mark class=\"potential-name\">$1</mark>');\r\n    return resultString;\r\n}\r\nfunction richTextSelectionHandler(event) {\r\n    var htmlTextElement = document.querySelector(\"div.htmltext\");\r\n    if (mouseDown) {\r\n        htmlTextElement.removeEventListener(\"mouseup\", displayRichTextSelectionToolbar);\r\n        htmlTextElement.addEventListener(\"mouseup\", displayRichTextSelectionToolbar);\r\n    }\r\n    else {\r\n        displayRichTextSelectionToolbar();\r\n    }\r\n}\r\nfunction displayRichTextSelectionToolbar() {\r\n    var selection = document.getSelection();\r\n    if (selection.rangeCount == 0 || selection.getRangeAt(0).collapsed) {\r\n        removeRichTextSelectionToolbar();\r\n        return;\r\n    }\r\n    var range = selection.getRangeAt(0);\r\n    var htmlTextElement = document.querySelector(\"div.htmltext\");\r\n    if (htmlTextElement.contains(range.startContainer) && htmlTextElement.contains(range.endContainer)) {\r\n        var selectionToolbar = getSelectionToolbar(true);\r\n        var rangeBound = range.getBoundingClientRect();\r\n        var xPosition = rangeBound.x;\r\n        var yPosition = rangeBound.y + rangeBound.height;\r\n        selectionToolbar.style.left = xPosition + \"px\";\r\n        selectionToolbar.style.top = yPosition + \"px\";\r\n        document.removeEventListener(\"click\", removeRichTextSelectionToolbar);\r\n        document.addEventListener(\"click\", removeRichTextSelectionToolbar);\r\n    }\r\n}\r\nfunction removeRichTextSelectionToolbar() {\r\n    var selection = document.getSelection();\r\n    if (selection.rangeCount == 0 || selection.getRangeAt(0).collapsed) {\r\n        var selectionToolbar = getSelectionToolbar(false);\r\n        if (selectionToolbar) {\r\n            selectionToolbar.remove();\r\n        }\r\n        document.removeEventListener(\"click\", removeRichTextSelectionToolbar);\r\n    }\r\n}\r\nfunction getSelectionToolbar(createIfNull) {\r\n    var selectionToolbar = document.querySelector(\"div.selection-toolbar\");\r\n    if (selectionToolbar == null && createIfNull) {\r\n        var template = document.querySelector(\"template.selection-toolbar\");\r\n        var clone = document.importNode(template.content, true);\r\n        selectionToolbar = clone.querySelector(\"div.selection-toolbar\");\r\n        document.querySelector(\"div.html-panel\").appendChild(clone);\r\n        var listButtons = selectionToolbar.querySelectorAll(\".name-categories button\");\r\n        listButtons.forEach(function (button) {\r\n            button.addEventListener(\"click\", function (event) {\r\n                var category = event.target.value;\r\n                addSelectionToList(category);\r\n            });\r\n        });\r\n        var genderButtons = selectionToolbar.querySelectorAll(\".gendering button\");\r\n        genderButtons.forEach(function (button) {\r\n            button.addEventListener(\"click\", function (event) {\r\n                var gender = event.target.value;\r\n                genderSelection(gender);\r\n            });\r\n        });\r\n    }\r\n    return selectionToolbar;\r\n}\r\nfunction addSelectionToList(category) {\r\n    var selection = document.getSelection();\r\n    var range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\r\n    if (range == null)\r\n        return;\r\n    var dataBlobs = localConfig.filter(function (dataBlob) { return dataBlob.xmlElementChildrenName == category; });\r\n    if (dataBlobs.length > 0) {\r\n        var dataBlob = dataBlobs[0];\r\n        MetaData.addToListelement(dataBlob, [range.toString().trim()]);\r\n    }\r\n}\r\nfunction genderSelection(gender) {\r\n    var selection = document.getSelection();\r\n    var range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\r\n    if (range == null)\r\n        return;\r\n    var startElement = range.startContainer.parentNode;\r\n    if (startElement.tagName == \"MARK\" && startElement.classList.contains(\"gendered\")) {\r\n        Dom.unwrapElement(startElement);\r\n        return;\r\n    }\r\n    document.querySelectorAll(\"div.htmltext mark.gendered\").forEach(function (mark) {\r\n        if (range.intersectsNode(mark)) {\r\n            Dom.unwrapElement(mark);\r\n        }\r\n    });\r\n    var genderMark = document.createElement(\"mark\");\r\n    genderMark.className = \"gendered \" + gender;\r\n    try {\r\n        range.surroundContents(genderMark);\r\n    }\r\n    catch (_a) {\r\n        console.log(\"Can't add mark there.\");\r\n    }\r\n}\r\n\n},{\"./codeview\":3,\"./dom\":5,\"./metadata\":11,\"./namesearch\":12,\"./xml\":13}],9:[function(require,module,exports){\n\"use strict\";\r\nexports.__esModule = true;\r\nvar DocumentNodeType;\r\n(function (DocumentNodeType) {\r\n    DocumentNodeType[DocumentNodeType[\"input\"] = 0] = \"input\";\r\n    DocumentNodeType[DocumentNodeType[\"textarea\"] = 1] = \"textarea\";\r\n})(DocumentNodeType = exports.DocumentNodeType || (exports.DocumentNodeType = {}));\r\nvar BlobType;\r\n(function (BlobType) {\r\n    BlobType[BlobType[\"generalMetaData\"] = 0] = \"generalMetaData\";\r\n    BlobType[BlobType[\"list\"] = 1] = \"list\";\r\n    BlobType[BlobType[\"fulltext\"] = 2] = \"fulltext\";\r\n    BlobType[BlobType[\"summary\"] = 3] = \"summary\";\r\n})(BlobType = exports.BlobType || (exports.BlobType = {}));\r\n\n},{}],10:[function(require,module,exports){\n\"use strict\";\r\nexports.__esModule = true;\r\nvar BigDialog = require(\"./bigdialog\");\r\nvar FormHandling = require(\"./forms\");\r\nvar MetaData = require(\"./metadata\");\r\nfunction displayDialog(defaultSearch, wikiUrl, callback) {\r\n    var dialog = BigDialog.setupDialog(\"Download from Wikisource\", true, [\r\n        {\r\n            title: \"Download and append to text\",\r\n            text: \"Append\",\r\n            value: \"append\"\r\n        },\r\n        {\r\n            title: \"Download and replace current text\",\r\n            text: \"Download\",\r\n            value: \"replace\"\r\n        }\r\n    ]);\r\n    var searchForm = dialog.querySelector(\"form.search-box\");\r\n    searchForm.wikiDialog = dialog;\r\n    dialog.wikiUrl = wikiUrl;\r\n    dialog.callback = callback;\r\n    dialog.resultRowTemplate = dialog.querySelector(\".result-row\");\r\n    var searchBox = searchForm.querySelector(\"input[type=text]\");\r\n    searchBox.value = defaultSearch;\r\n    searchForm.dispatchEvent(new Event(\"input\"));\r\n    searchForm.addEventListener(\"submit\", function (event) {\r\n        event.preventDefault();\r\n        var dialog = this.wikiDialog;\r\n        var query = this.querySelector(\"input.query\").value;\r\n        dialog.query = query;\r\n        searchMediaWiki(query, dialog);\r\n    });\r\n    dialog.addEventListener(\"close\", function () {\r\n        var dialog = this;\r\n        if (dialog.returnValue != \"cancel\") {\r\n            var selectedItem = dialog.querySelector(\".results input[type=radio][name=title]:checked\");\r\n            if (selectedItem) {\r\n                var title = selectedItem.value;\r\n                var wikiUrl_1 = dialog.wikiUrl;\r\n                if (dialog.returnValue == \"replace\") {\r\n                    getMediaWikiText(title, wikiUrl_1, true, dialog.callback);\r\n                }\r\n                else if (dialog.returnValue == \"append\") {\r\n                    getMediaWikiText(title, wikiUrl_1, false, dialog.callback);\r\n                }\r\n                else {\r\n                    alert(\"Whatcho talkin bout Willis?\");\r\n                }\r\n            }\r\n        }\r\n        dialog.remove();\r\n    });\r\n    dialog.showModal();\r\n}\r\nexports.displayDialog = displayDialog;\r\nfunction searchMediaWiki(query, dialog) {\r\n    var endpoint = dialog.wikiUrl + \"/w/api.php?action=query&list=search&prop=info&inprop=url&utf8=&format=json&origin=*&srlimit=15&srsearch=\" + query;\r\n    fetch(endpoint)\r\n        .then(function (response) { return response.json(); })\r\n        .then(function (data) {\r\n        var searchResults = data.query.search;\r\n        var titles = [];\r\n        searchResults.forEach(function (result) {\r\n            titles.push(result.title);\r\n        });\r\n        displaySearchResults(titles, dialog);\r\n    });\r\n}\r\nfunction displaySearchResults(titles, dialog) {\r\n    var template = dialog.resultRowTemplate.content;\r\n    var container = dialog.querySelector(\".results ul\");\r\n    var resultsForm = dialog.querySelector(\"form.search-results\");\r\n    container.innerHTML = \"\";\r\n    if (titles.length == 0) {\r\n        container.innerHTML = \"No results found for \" + dialog.query + \".\";\r\n        FormHandling.SetSubmitButtonEnabled(resultsForm, false);\r\n    }\r\n    else {\r\n        titles.forEach(function (title) {\r\n            var row = template.cloneNode(true);\r\n            row.querySelector(\".text\").innerHTML = title;\r\n            row.querySelector(\"input[name=title]\").value = title;\r\n            container.appendChild(row);\r\n        });\r\n        resultsForm.dispatchEvent(new Event(\"input\"));\r\n    }\r\n}\r\nfunction wikiToXML(text) {\r\n    var replacements = [\r\n        {\r\n            description: \"Remove noinclude\",\r\n            regexp: /<noinclude>([\\S\\s]*?)<\\/noinclude>/g,\r\n            replacement: \"$1\"\r\n        },\r\n        {\r\n            description: \"Remove drop initial\",\r\n            regexp: /{{2}drop *initial\\|(.)}{2}/g,\r\n            replacement: \"$1\"\r\n        },\r\n        {\r\n            description: \"Remove small caps\",\r\n            regexp: /{{2}sc\\|(.*?)}{2}/g,\r\n            replacement: \"$1\"\r\n        },\r\n        {\r\n            description: \"Remove end notes\",\r\n            regexp: /==Endnotes==[\\S\\s]*$/g,\r\n            replacement: \"\"\r\n        },\r\n        {\r\n            description: \"Remove tooltips\",\r\n            regexp: /{{2}tooltip\\|(.*?)\\|.*?\\}{2}/g,\r\n            replacement: \"$1\"\r\n        },\r\n        {\r\n            description: \"Remove references\",\r\n            regexp: /<ref>.*?<\\/ref>/g,\r\n            replacement: \"\"\r\n        },\r\n        {\r\n            description: \"Remove indentations\",\r\n            regexp: /\\n[ \\t]+/g,\r\n            replacement: \"\\n\"\r\n        },\r\n        {\r\n            description: \"Remove links\",\r\n            regexp: /\\[{2}.*?\\|(.*?)\\]{2}/g,\r\n            replacement: \"$1\"\r\n        },\r\n        {\r\n            description: \"Remove right-aligning\",\r\n            regexp: /{{2}right.*?\\|(.*?)\\}{2}/g,\r\n            replacement: \"$1\"\r\n        },\r\n        {\r\n            description: \"Remove centering\",\r\n            regexp: /{{2}c.*?\\|(.*?)}{2}/g,\r\n            replacement: \"$1\"\r\n        },\r\n        {\r\n            description: \"Remove blocks\",\r\n            regexp: /{{2}block.*?\\|(.*?)}{2}/gs,\r\n            replacement: \"$1\"\r\n        },\r\n        {\r\n            description: \"Fix attributes without quotes\",\r\n            regexp: /<(.*?) (.*?)=([^\"].*?)([ >])/,\r\n            replacement: '<$1 $2=\"$3\"$4',\r\n            exhaust: true\r\n        },\r\n        {\r\n            description: \"Heading\",\r\n            regexp: /{{2}xx-larger\\|(.*?)}{2}\\n* /g,\r\n            replacement: \"<h1>$1</h1>\\n\\n\"\r\n        },\r\n        {\r\n            description: \"Chapter title\",\r\n            regexp: /==(.*?)==\\n*/g,\r\n            replacement: \"<h2>$1</h2>\\n\\n\"\r\n        },\r\n        {\r\n            description: \"Poem lines with 2 indent | EXHAUST\",\r\n            regexp: /<poem>([\\S\\s]*?)\\n(?!<line)::(.+?)\\n([\\S\\s]*?)<\\/poem>/g,\r\n            replacement: \"<poem>$1\\n<line indent=2>$2</line>\\n$3</poem>\",\r\n            exhaust: true\r\n        },\r\n        {\r\n            description: \"Poem lines with 1 indent | EXHAUST\",\r\n            regexp: /<poem>([\\S\\s]*?)\\n(?!<line):(.+?)\\n([\\S\\s]*?)<\\/poem>/g,\r\n            replacement: \"<poem>$1\\n<line indent=1>$2</line>\\n$3</poem>\",\r\n            exhaust: true\r\n        },\r\n        {\r\n            description: \"Poem lines without indent | EXHAUST\",\r\n            regexp: /<poem>([\\S\\s]*?)\\n(?!<line)(.+?)\\n([\\S\\s]*?)<\\/poem>/g,\r\n            replacement: \"<poem>$1\\n<line>$2</line>\\n$3</poem>\",\r\n            exhaust: true\r\n        },\r\n        {\r\n            description: \"Poem lines using br tag\",\r\n            regexp: /\\n(.*)<br\\/>/g,\r\n            replacement: \"\\n<line>$1</line>\"\r\n        },\r\n        {\r\n            description: \"Add paragraph </p><p>tags\",\r\n            regexp: /\\n\\n/g,\r\n            replacement: \"</p>\\n\\n<p>\"\r\n        },\r\n        {\r\n            description: \"Remove last paragraph start tag (b/c logic)\",\r\n            regexp: /([\\S\\s]*)<p>/g,\r\n            replacement: \"$1\"\r\n        },\r\n        {\r\n            description: \"Remove first paragraph end tag (b/ logic)\",\r\n            regexp: /<\\/p>([\\S\\s]*)/g,\r\n            replacement: \"$1\"\r\n        },\r\n        {\r\n            description: \"Remove line breaks after paragraph start\",\r\n            regexp: /<p>\\n+/g,\r\n            replacement: \"<p>\"\r\n        },\r\n        {\r\n            description: \"Reverse poem and paragraph start tags\",\r\n            regexp: /<p>\\n*<poem>/g,\r\n            replacement: \"<poem>\\n<p>\"\r\n        },\r\n        {\r\n            description: \"Reverse poem and paragraph end tags\",\r\n            regexp: /<\\/poem>\\n*<\\/p>/g,\r\n            replacement: \"</p>\\n</poem>\"\r\n        },\r\n        {\r\n            description: \"Separate first line of poem pagagraph from paragraph start tag\",\r\n            regexp: /<p><line>/g,\r\n            replacement: \"<p>\\n<line>\"\r\n        },\r\n        {\r\n            description: \"Separate last line of poem paragraph from paragraph end tag\",\r\n            regexp: /<\\/line><\\/p>/g,\r\n            replacement: \"</line>\\n</p>\"\r\n        },\r\n        {\r\n            description: \"Remove paragraph tags around headings\",\r\n            regexp: /<p><(h[0-5])>(.*?)<\\/\\1><\\/p>/g,\r\n            replacement: \"<$1>$2</$1>\\n\\n\"\r\n        },\r\n        {\r\n            description: \"'' to emph\",\r\n            regexp: /\\'{2}(.*?)\\'{2}/g,\r\n            replacement: \"<emph>$1</emph>\"\r\n        },\r\n        {\r\n            description: \"Remove triple newlines\",\r\n            regexp: /\\n\\n\\n/g,\r\n            replacement: \"\\n\\n\",\r\n            exhaust: true\r\n        },\r\n        {\r\n            description: \"Remove double spaces\",\r\n            regexp: /  /g,\r\n            replacement: \" \",\r\n            exhaust: true\r\n        },\r\n        {\r\n            description: \"&nbsp; to space\",\r\n            regexp: /&nbsp;/g,\r\n            replacement: \" \"\r\n        },\r\n        {\r\n            description: \"Ellipsis\",\r\n            regexp: /\\. ?\\. ?\\./g,\r\n            replacement: \"\"\r\n        }\r\n    ];\r\n    var convertedText = text;\r\n    replacements.forEach(function (replacement) {\r\n        if (replacement.exhaust) {\r\n            while (convertedText.search(replacement.regexp) >= 0) {\r\n                convertedText = convertedText.replace(replacement.regexp, replacement.replacement);\r\n            }\r\n        }\r\n        else {\r\n            convertedText = convertedText.replace(replacement.regexp, replacement.replacement);\r\n        }\r\n    });\r\n    return convertedText;\r\n}\r\nfunction getMediaWikiText(article, wikiUrl, replace, resultHandler) {\r\n    var endpoint = wikiUrl + \"/w/api.php?action=query&prop=revisions&rvprop=content&format=json&origin=*&rvslots=main&titles=\" + article;\r\n    fetch(endpoint)\r\n        .then(function (response) { return response.json(); })\r\n        .then(function (data) {\r\n        var pages = data.query.pages;\r\n        var page = pages[Object.keys(pages)[0]];\r\n        if (page.revisions) {\r\n            var text = page.revisions[0].slots.main[\"*\"];\r\n            if (replace) {\r\n                handleMetadata(text);\r\n            }\r\n            resultHandler(wikiToXML(text), replace);\r\n        }\r\n    });\r\n}\r\nfunction handleMetadata(text) {\r\n    var metaDataFields = [\r\n        {\r\n            fieldName: \"title\",\r\n            regex: /title *= (.*)/g\r\n        },\r\n        {\r\n            fieldName: \"author\",\r\n            regex: /author *= (.*)/g\r\n        },\r\n        {\r\n            fieldName: \"published\",\r\n            regex: /year *= (.*)/g\r\n        }\r\n    ];\r\n    metaDataFields.forEach(function (field) {\r\n        var result = field.regex.exec(text);\r\n        if (result) {\r\n            MetaData.setMetadataField(field.fieldName, result[1]);\r\n        }\r\n    });\r\n}\r\n\n},{\"./bigdialog\":2,\"./forms\":7,\"./metadata\":11}],11:[function(require,module,exports){\n\"use strict\";\r\nexports.__esModule = true;\r\nvar Dom = require(\"./dom\");\r\nvar DecisionDialog = require(\"./decisiondialog\");\r\nfunction addToListelement(dataBlob, newContent, force) {\r\n    if (force === void 0) { force = false; }\r\n    var element = Dom.getHtmlElementOf(dataBlob, false).element;\r\n    var originalText = element.value;\r\n    var originalContentArray = originalText == \"\" ? [] : originalText.split(\"\\n\");\r\n    if (!force) {\r\n        var intersection = originalContentArray.filter(function (item) { return -1 !== newContent.indexOf(item); });\r\n        if (intersection.length > 0) {\r\n            DecisionDialog.displayDialog(\"Duplicates\", \"Some of the items you're trying to add to \" + dataBlob.name + \" are duplicates. Add them anyway?\", \"\", function (dataString) {\r\n                addToListelement(dataBlob, newContent, true);\r\n            });\r\n            return;\r\n        }\r\n    }\r\n    var newContentArray = originalContentArray.concat(newContent);\r\n    element.value = newContentArray.join(\"\\n\");\r\n}\r\nexports.addToListelement = addToListelement;\r\nfunction setMetadataField(field, newText) {\r\n    var fieldElement = document.querySelector(\"section.metadata input[name=\\\"\" + field + \"\\\"]\");\r\n    console.log(fieldElement);\r\n    if (!fieldElement)\r\n        return;\r\n    fieldElement.value = newText;\r\n}\r\nexports.setMetadataField = setMetadataField;\r\nfunction setupLists(config) {\r\n    document.querySelectorAll(\".metadata section header button[value='clean'\").forEach(function (btn) {\r\n        btn.addEventListener(\"click\", function () {\r\n            var sectionParent = btn.parentElement.parentElement;\r\n            if (sectionParent.matches(\"section\")) {\r\n                cleanList(sectionParent.querySelector(\"textarea\"));\r\n            }\r\n        });\r\n    });\r\n    var nameBlobs = config.filter(function (dataBlob) { return dataBlob.containsNames; });\r\n    nameBlobs.forEach(function (dataBlob) {\r\n        var element = Dom.getHtmlElementOf(dataBlob, false).element;\r\n        element.addEventListener(\"click\", function (event) {\r\n            var textAreaElement = event.currentTarget;\r\n            var line = getCurrentLine(textAreaElement);\r\n            console.log(line);\r\n        });\r\n    });\r\n}\r\nexports.setupLists = setupLists;\r\nfunction getCurrentLine(textAreaElement) {\r\n    var text = textAreaElement.value;\r\n    var cursorStart = textAreaElement.selectionStart;\r\n    var lineStart = Math.max(text.substr(0, cursorStart).lastIndexOf(\"\\n\") + 1, 0);\r\n    var lineEnd = text.substr(cursorStart).indexOf(\"\\n\");\r\n    lineEnd = lineEnd < 0 ? text.length : cursorStart + lineEnd;\r\n    return text.substring(lineStart, lineEnd);\r\n}\r\nfunction cleanList(textarea) {\r\n    var originalContent = textarea.value;\r\n    var list = [];\r\n    originalContent.split(\"\\n\").forEach(function (line) {\r\n        var parts = line.split(\"|\", 2);\r\n        list.push({\r\n            content: parts.length == 2 ? parts[1] : parts[0],\r\n            metaData: parts.length == 2 ? parts[0] : null\r\n        });\r\n    });\r\n    list = list.filter(function (item, index, self) {\r\n        return self.map(function (innerItem) { return innerItem.content; }).indexOf(item.content) === index;\r\n    });\r\n    list = list.filter(function (item) {\r\n        return item.content.length > 0;\r\n    });\r\n    list = list.sort(function (a, b) { return (a.content > b.content) ? 1 : -1; });\r\n    var resultList = list.map(function (item) {\r\n        return item.metaData ? item.metaData + \"|\" + item.content : item.content;\r\n    });\r\n    textarea.value = resultList.join(\"\\n\");\r\n}\r\nexports.cleanList = cleanList;\r\n\n},{\"./decisiondialog\":4,\"./dom\":5}],12:[function(require,module,exports){\n\"use strict\";\r\nexports.__esModule = true;\r\nvar BigDialog = require(\"./bigdialog\");\r\nvar MetaData = require(\"./metadata\");\r\nexports.nameRegex = /(?<![\\.;:!?] *) (?:<emph>)?((?:[A-Z][\\w]+ ?)+),?/g;\r\nfunction generateItemOptions(Config) {\r\n    var dataBlobs = Config.filter(function (pair) { return pair.containsNames == true; });\r\n    var itemOptions = [];\r\n    dataBlobs.forEach(function (dataBlob) {\r\n        itemOptions.push({\r\n            text: dataBlob.xmlElementChildrenName.charAt(0).toUpperCase() + dataBlob.xmlElementChildrenName.slice(1),\r\n            value: dataBlob.xmlElementChildrenName\r\n        });\r\n    });\r\n    itemOptions.push({\r\n        text: \"Ignore\",\r\n        value: \"ignore\",\r\n        checked: true\r\n    });\r\n    return itemOptions;\r\n}\r\nfunction displayDialog(text, config) {\r\n    var dialog = BigDialog.setupDialog(\"Detected names\", false, [\r\n        {\r\n            title: \"Append names to lists\",\r\n            text: \"Append\",\r\n            value: \"append\"\r\n        },\r\n        {\r\n            title: \"Cancel\",\r\n            text: \"Cancel\",\r\n            value: \"cancel\"\r\n        }\r\n    ]);\r\n    var possibleNames = findUniqueMatches(text, exports.nameRegex);\r\n    displayMatches(possibleNames, text, dialog, generateItemOptions(config));\r\n    dialog.addEventListener(\"close\", function () {\r\n        var dialog = this;\r\n        if (dialog.returnValue == \"append\") {\r\n            var categorized_1 = {};\r\n            var dataBlobs = config.filter(function (pair) { return pair.containsNames == true; });\r\n            dataBlobs.forEach(function (dataBlob) {\r\n                categorized_1[dataBlob.xmlElementChildrenName] = {\r\n                    dataBlob: dataBlob,\r\n                    content: []\r\n                };\r\n            });\r\n            var checkedElements = dialog.querySelectorAll(\"input[type=radio]:checked:not([value=ignore])\");\r\n            checkedElements.forEach(function (element) {\r\n                if (Object.keys(categorized_1).indexOf(element.value) >= 0) {\r\n                    var category = categorized_1[element.value].content;\r\n                    category.push(element.name);\r\n                }\r\n            });\r\n            Object.keys(categorized_1).forEach(function (categoryName) {\r\n                var category = categorized_1[categoryName];\r\n                MetaData.addToListelement(category.dataBlob, category.content);\r\n            });\r\n        }\r\n        dialog.remove();\r\n    });\r\n    dialog.showModal();\r\n}\r\nexports.displayDialog = displayDialog;\r\nfunction displayMatches(matches, text, dialog, itemOptions) {\r\n    var resultsContainer = dialog.querySelector(\".results ul\");\r\n    resultsContainer.innerHTML = \"\";\r\n    if (matches.length > 0) {\r\n        var template_1 = dialog.querySelector(\".complex-result-row\");\r\n        var optionTemplate_1 = dialog.querySelector(\".complex-result-row.option\");\r\n        matches.forEach(function (match) {\r\n            var rowElement = document.importNode(template_1.content, true);\r\n            var textElement = rowElement.querySelector(\".description\");\r\n            var detailsElement = rowElement.querySelector(\".details\");\r\n            textElement.innerText = match.matchText;\r\n            detailsElement.innerHTML = makeAbstract(match, text);\r\n            makeOptionItems(match.matchText, itemOptions, rowElement, optionTemplate_1);\r\n            resultsContainer.appendChild(rowElement);\r\n        });\r\n    }\r\n}\r\nfunction makeOptionItems(name, itemOptions, rowElement, optionTemplate) {\r\n    var optionsContainer = rowElement.querySelector(\".item-options\");\r\n    optionsContainer.innerHTML = \"\";\r\n    itemOptions.forEach(function (itemOption) {\r\n        var optionElement = document.importNode(optionTemplate.content, true);\r\n        var inputElement = optionElement.querySelector(\"input\");\r\n        var spanElement = optionElement.querySelector(\"span\");\r\n        inputElement.value = itemOption.value;\r\n        inputElement.setAttribute(\"name\", name);\r\n        inputElement.checked = itemOption.checked;\r\n        spanElement.textContent = itemOption.text;\r\n        optionsContainer.appendChild(optionElement);\r\n    });\r\n}\r\nfunction makeAbstract(matchGroup, text) {\r\n    var abstractStart = \"\" + text.substring(Math.max(matchGroup.indexStart - 24, 0), matchGroup.indexStart);\r\n    var abstractMain = \" <strong>\" + matchGroup.matchText + \"</strong> \";\r\n    var abstractEnd = text.substring(matchGroup.indexEnd, Math.max(matchGroup.indexEnd + 24, 0)) + \"\";\r\n    abstractStart = abstractStart.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\r\n    abstractEnd = abstractEnd.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\r\n    return abstractStart + abstractMain + abstractEnd;\r\n}\r\nfunction findUniqueMatches(text, regExp) {\r\n    var matches = [];\r\n    var groups;\r\n    var foundNames = [];\r\n    while ((groups = regExp.exec(text)) !== null) {\r\n        var match = groups[1].trim();\r\n        if (foundNames.indexOf(match) < 0) {\r\n            foundNames.push(match);\r\n            matches.push({\r\n                matchText: groups[1].trim(),\r\n                indexStart: groups.index,\r\n                indexEnd: regExp.lastIndex\r\n            });\r\n        }\r\n    }\r\n    regExp.lastIndex = 0;\r\n    return matches;\r\n}\r\n\n},{\"./bigdialog\":2,\"./metadata\":11}],13:[function(require,module,exports){\n\"use strict\";\r\nexports.__esModule = true;\r\nvar DecisionDialog = require(\"./decisiondialog\");\r\nvar Interfaces = require(\"./interfaces\");\r\nvar Dom = require(\"./dom\");\r\nvar CodeView = require(\"./codeview\");\r\nfunction setup(config) {\r\n    loadXsltStylesheets();\r\n    var domParser = new DOMParser();\r\n    config.forEach(function (dataBlob) {\r\n        var domElements = Dom.getHtmlElementOf(dataBlob, true);\r\n        var element = domElements.element;\r\n        element.warningElement = domElements.warningElement;\r\n        element.addEventListener(\"input\", function (event) {\r\n            var element = this;\r\n            var xmlString = \"<body>\" + element.value + \"</body>\";\r\n            var testDom = domParser.parseFromString(xmlString, \"text/xml\");\r\n            element.warningElement.classList.toggle(\"xmlwarning\", !!testDom.querySelector(\"parsererror\"));\r\n            var exportButtonElement = document.querySelector(\".toolbar button[value='export']\");\r\n            exportButtonElement.disabled = !!testDom.querySelector(\"parsererror\");\r\n        });\r\n    });\r\n}\r\nexports.setup = setup;\r\nfunction loadXsltStylesheets() {\r\n    fetch(\"dist/xsl/codetohtml.xsl\")\r\n        .then(function (response) { return response.text(); })\r\n        .then(function (response) {\r\n        exports.xslCodeToHTML = new DOMParser().parseFromString(response, \"text/xml\");\r\n    });\r\n    fetch(\"dist/xsl/prettyxml.xsl\")\r\n        .then(function (response) { return response.text(); })\r\n        .then(function (response) {\r\n        exports.xslPrettyXML = new DOMParser().parseFromString(response, \"text/xml\");\r\n    });\r\n    fetch(\"dist/xsl/htmltocode.xsl\")\r\n        .then(function (response) { return response.text(); })\r\n        .then(function (response) {\r\n        exports.xslHTMLToCode = new DOMParser().parseFromString(response, \"text/xml\");\r\n    });\r\n}\r\nfunction makeXML(config) {\r\n    var xmlDocument = document.implementation.createDocument(\"\", \"\", null);\r\n    var xmlRoot = xmlDocument.createElement(\"work\");\r\n    xmlDocument.appendChild(xmlRoot);\r\n    config.forEach(function (dataBlob) {\r\n        var xmlElement = xmlDocument.createElement(dataBlob.xmlElementName);\r\n        var domElements = Dom.getHtmlElementOf(dataBlob, false);\r\n        var documentElement = domElements.element;\r\n        var text = documentElement.value;\r\n        if (dataBlob.xmlElementChildrenName) {\r\n            var lines = text.split(/[\\r\\n]+/);\r\n            lines.forEach(function (line) {\r\n                line = line.trim();\r\n                if (line.length > 0) {\r\n                    var xmlChildElement_1 = xmlDocument.createElement(dataBlob.xmlElementChildrenName);\r\n                    if (dataBlob.attributePairs && line.indexOf(\"|\") !== -1) {\r\n                        var parts = line.split(\"|\", 2);\r\n                        var attributes_1 = parts[0].toLowerCase();\r\n                        dataBlob.attributePairs.forEach(function (attributePair) {\r\n                            if (attributes_1.indexOf(attributePair.text) !== -1) {\r\n                                xmlChildElement_1.setAttribute(attributePair.xml.attribute, attributePair.xml.value);\r\n                            }\r\n                        });\r\n                        line = parts[1];\r\n                    }\r\n                    if (line.length > 0) {\r\n                        xmlChildElement_1.textContent = line;\r\n                        xmlElement.appendChild(xmlChildElement_1);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            xmlElement.innerHTML = text;\r\n        }\r\n        xmlRoot.appendChild(xmlElement);\r\n    });\r\n    xmlDocument = transformXml(xmlDocument, exports.xslPrettyXML);\r\n    var serializer = new XMLSerializer();\r\n    var xmlString = serializer.serializeToString(xmlDocument);\r\n    return xmlString;\r\n}\r\nexports.makeXML = makeXML;\r\nfunction loadXml(xmlText, config) {\r\n    var domParser = new DOMParser();\r\n    var xmlDocument = domParser.parseFromString(xmlText, \"text/xml\");\r\n    config.forEach(function (dataBlob) {\r\n        var xmlElement = xmlDocument.querySelector(dataBlob.xmlElementName);\r\n        if (xmlElement) {\r\n            var domElements = Dom.getHtmlElementOf(dataBlob, false);\r\n            var documentElement = domElements.element;\r\n            if (dataBlob.type == Interfaces.BlobType.list) {\r\n                var xmlChildElements = xmlElement.querySelectorAll(dataBlob.xmlElementChildrenName);\r\n                var textElements_1 = [];\r\n                xmlChildElements.forEach(function (childElement) {\r\n                    var attributePreamble = \"\";\r\n                    if (dataBlob.attributePairs) {\r\n                        dataBlob.attributePairs.forEach(function (attributePair) {\r\n                            if (childElement.getAttribute(attributePair.xml.attribute) == attributePair.xml.value) {\r\n                                attributePreamble += attributePair.text;\r\n                            }\r\n                        });\r\n                        attributePreamble += \"|\";\r\n                    }\r\n                    textElements_1.push(attributePreamble + childElement.innerHTML);\r\n                });\r\n                documentElement.value = textElements_1.join(\"\\n\");\r\n            }\r\n            else if ([Interfaces.BlobType.fulltext, Interfaces.BlobType.summary].indexOf(dataBlob.type) >= 0) {\r\n                var xmlDocument_1 = document.implementation.createDocument(null, \"tmp\", null);\r\n                xmlDocument_1.replaceChild(xmlElement, xmlDocument_1.documentElement);\r\n                xmlDocument_1 = transformXml(xmlDocument_1, exports.xslPrettyXML);\r\n                if (dataBlob.type == Interfaces.BlobType.fulltext) {\r\n                    CodeView.SetTextBody(unwrapXml(xmlDocument_1), true, true);\r\n                }\r\n                else {\r\n                    documentElement.value = unwrapXml(xmlDocument_1);\r\n                }\r\n            }\r\n            else {\r\n                console.log(dataBlob.name);\r\n                documentElement.value = xmlElement.innerHTML;\r\n            }\r\n        }\r\n    });\r\n}\r\nexports.loadXml = loadXml;\r\nfunction unwrapXml(xmlDocument) {\r\n    var result = xmlDocument.documentElement.innerHTML;\r\n    var linespaceRegex = /^  /gm;\r\n    var newlineRegex = /^\\n|\\n$/g;\r\n    result = result.replace(linespaceRegex, \"\");\r\n    result = result.replace(newlineRegex, \"\");\r\n    return result;\r\n}\r\nexports.unwrapXml = unwrapXml;\r\nfunction clear(config) {\r\n    DecisionDialog.displayDialog(\"Clear all fields\", \"Are you sure? This will clear all fields and give you a clean slate.\", \"yes\", function (decision) {\r\n        if (decision == \"yes\") {\r\n            config.forEach(function (dataBlob) {\r\n                var domElement = Dom.getHtmlElementOf(dataBlob, false);\r\n                domElement.element.value = \"\";\r\n            });\r\n        }\r\n    });\r\n}\r\nexports.clear = clear;\r\nfunction transformXml(originalDocument, xslStylesheet) {\r\n    if (!xslStylesheet) {\r\n        console.log(\"XSL stylesheet not loaded yet\");\r\n        return null;\r\n    }\r\n    var xsltProcessor = new XSLTProcessor();\r\n    xsltProcessor.importStylesheet(xslStylesheet);\r\n    var result = xsltProcessor.transformToDocument(originalDocument);\r\n    return result;\r\n}\r\nexports.transformXml = transformXml;\r\n\n},{\"./codeview\":3,\"./decisiondialog\":4,\"./dom\":5,\"./interfaces\":9}],14:[function(require,module,exports){\n\"use strict\";\r\nexports.__esModule = true;\r\nvar Xml = require(\"./modules/xml\");\r\nvar FileManagement = require(\"./modules/filemanagement\");\r\nvar CodeView = require(\"./modules/codeview\");\r\nvar HtmlView = require(\"./modules/htmlview\");\r\nvar MetaData = require(\"./modules/metadata\");\r\nvar MediaWikiSearch = require(\"./modules/mediawikisearch\");\r\nvar NameSearch = require(\"./modules/namesearch\");\r\nvar Config = require(\"./DataBlobConfig\");\r\nfunction setupToolbar() {\r\n    document.querySelector(\"section.toolbar button.wikisource\").addEventListener(\"click\", function (event) {\r\n        event.preventDefault();\r\n        var title = document.querySelector(\".metadata input[name=title]\").value;\r\n        MediaWikiSearch.displayDialog(title, \"https://en.wikisource.org\", CodeView.SetTextBody);\r\n    });\r\n    document.querySelector(\"section.toolbar button[value='find-names']\").addEventListener(\"click\", function (event) {\r\n        event.preventDefault();\r\n        NameSearch.displayDialog(CodeView.GetTextBody(), Config.dataBlobs);\r\n    });\r\n    document.querySelector(\"section.toolbar button[value='export']\").addEventListener(\"click\", function (event) {\r\n        event.preventDefault();\r\n        var xmlString = Xml.makeXML(Config.dataBlobs);\r\n        var title = document.querySelector(\".metadata input[name=title]\").value;\r\n        if (title.length == 0) {\r\n            title = \"Unknown\";\r\n        }\r\n        var filename = title + \".xml\";\r\n        FileManagement.saveFile(filename, \"text/xml\", xmlString);\r\n    });\r\n    document.querySelector(\"section.toolbar button[value='import']\").addEventListener(\"click\", function (event) {\r\n        event.preventDefault();\r\n        FileManagement.loadFile(Xml.loadXml, Config.dataBlobs);\r\n    });\r\n    document.querySelector(\"section.toolbar button[value='clear']\").addEventListener(\"click\", function (event) {\r\n        event.preventDefault();\r\n        Xml.clear(Config.dataBlobs);\r\n    });\r\n}\r\nsetupToolbar();\r\nHtmlView.setup(Config.dataBlobs);\r\nXml.setup(Config.dataBlobs);\r\nMetaData.setupLists(Config.dataBlobs);\r\n\n},{\"./DataBlobConfig\":1,\"./modules/codeview\":3,\"./modules/filemanagement\":6,\"./modules/htmlview\":8,\"./modules/mediawikisearch\":10,\"./modules/metadata\":11,\"./modules/namesearch\":12,\"./modules/xml\":13}]},{},[14]);\n"]}